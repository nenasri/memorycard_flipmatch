<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Game Result</title>
<style>
body{
  margin:0;
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  background:url(background.jpg) center/cover no-repeat;
  font-family:Arial,sans-serif;
  position:relative;
  overflow:hidden;
  opacity:0;
  transition: opacity 1s ease-in-out;
}

body.visible { opacity:1; }

.result-container{
  width:100%;
  max-width:420px;
  padding:20px;
  z-index:1;
}

.result-card{
  background:#fff;
  border-radius:18px;
  padding:32px 24px;
  text-align:center;
  box-shadow:0 25px 50px rgba(0,0,0,0.25);
  position:relative;
  z-index:1;
}

.badge{
  position:absolute;
  top:-18px;
  left:50%;
  transform:translateX(-50%);
  background:black;
  color:white;
  padding:8px 26px;
  border-radius:20px;
  font-weight:bold;
  letter-spacing:1px;
}

.status{
  margin-top:22px;
  font-size:26px;
  font-style:italic;
  letter-spacing:1px;
  transition: color 0.5s ease;
}

.status.failed{ color:red; font-weight:bold; }

.score-box{
  border:2px solid black;
  border-radius:16px;
  padding:22px;
  margin:26px 0;
  position:relative;
  z-index:1;
}

.score-title{ margin:0; font-weight:bold; letter-spacing:2px; }
.score-points{ font-size:36px; font-weight:bold; margin:10px 0; }
.stars{ font-size:28px; margin:12px 0; }

.stats{ font-size:14px; margin-top:14px; }
.stats p{ margin:6px 0; }

.btn{
  width:100%;
  padding:14px;
  margin-top:12px;
  border-radius:14px;
  font-weight:bold;
  font-size:16px;
  border:none;
  cursor:pointer;
}

/* BUTTONS DESIGN MATCHING GAME.HTML WITH GRADIENT */
#resultButtons button {
  background: linear-gradient(145deg, #ffeb3b, #fff176); /* gradient yellow */
  color: #333;
  border: none;
  border-radius: 14px;
  padding: 14px 36px;
  font-size: 1.1rem;
  font-weight: bold;
  cursor: pointer;
  margin-top: 12px;
  width: 100%;
  transition: transform 0.2s, box-shadow 0.2s, background 0.3s;
  width: 60%;
  margin-left: 20%;
}

#resultButtons button:hover {
  transform: scale(1.05);
  box-shadow: 0 0 20px #fff176;
  background: linear-gradient(145deg, #fff176, #ffeb3b); /* reverse gradient on hover */
}

/* Optional: maintain spacing if some buttons hidden */
#resultButtons {
  display: flex;
  flex-direction: column;
  gap: 12px;
  margin-top: 20px;
}


.btn.primary{ background:black; color:white; z-index:1; position:relative; }
.btn.secondary{ background:#e5e5e5; color:black; z-index:1; position:relative; }

/* RAINING STARS */
.star{
  position:absolute;
  width:25px;
  height:25px;
  background: gold;
  border-radius:50%;
  opacity:0.9;
  box-shadow: 0 0 20px gold, 0 0 35px yellow;
  animation: fall linear forwards;
}

@keyframes fall{
  0% { transform: translateY(-50px) translateX(0) scale(1); opacity:1; }
  100% { transform: translateY(120vh) translateX(var(--x)) scale(0.6); opacity:0; }
}
</style>
</head>

<body>

<div class="result-container">
  <div class="result-card">
    <div class="badge">RESULT</div>
    <h2 class="status" id="statusText">LEVEL COMPLETE!</h2>

    <div class="score-box">
      <p class="score-title">SCORE</p>
      <p class="score-points" id="scoreDisplay">0PTS</p>
      <div class="stars" id="starsDisplay"></div>

      <div class="stats">
        <p>Time: <span id="timeDisplay">00:00</span></p>
        <p>Moves Used: <span id="movesDisplay">0</span></p>
        <p>Bonus: <span id="bonusDisplay">-</span></p>
      </div>
    </div>

    <div id="resultButtons">
      <button id="retryBtn">Retry</button>
      <button id="nextBtn">Next Level</button>
      <button onclick="window.location.href='./'">Back to Home</button>
    </div>
  </div>
</div>

<script>
// FADE-IN BODY
window.addEventListener("load",()=>{document.body.classList.add("visible");});

// READ DATA FROM URL
const params = new URLSearchParams(window.location.search);
const score  = parseInt(params.get("score")) || 0;
const stars  = parseInt(params.get("stars")) || 0;
const time   = params.get("time")   || "00:00";
const moves  = params.get("moves")  || "0";
const bonus  = params.get("bonus")  || "-";
const passed = params.get("passed") === "true";
const level  = (params.get("level") || "easy").toLowerCase();
const mode   = params.get("mode")   || "classic";
const theme  = params.get("theme")  || "fruits";
const playerName = params.get("name") || "YOU"; // optional name

// DISPLAY DATA
document.getElementById("scoreDisplay").textContent = score + "PTS";
document.getElementById("starsDisplay").textContent = "⭐".repeat(stars);
document.getElementById("timeDisplay").textContent = time;
document.getElementById("movesDisplay").textContent = moves;
document.getElementById("bonusDisplay").textContent = bonus;

// STATUS TEXT
const statusText = document.getElementById("statusText");

// AUDIO CONTEXT
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
function playSound(freq,d=0.7){
  const o = audioCtx.createOscillator();
  const g = audioCtx.createGain();
  o.frequency.value=freq;
  o.type='triangle';
  g.gain.setValueAtTime(0.6,audioCtx.currentTime);
  g.gain.exponentialRampToValueAtTime(0.001,audioCtx.currentTime+d);
  o.connect(g);
  g.connect(audioCtx.destination);
  o.start();
  o.stop(audioCtx.currentTime+d);
}

// RAINING STARS
function startRainingStars(){
  const interval = setInterval(()=>{
    const s = document.createElement("div");
    s.className="star";
    s.textContent = "⭐";
    s.style.left = Math.random()*100 + "vw";
    s.style.setProperty('--x', (Math.random()*200-100) + "px");
    s.style.animationDuration = (2 + Math.random()*2) + "s";
    document.body.appendChild(s);
    setTimeout(()=>s.remove(),4000);
  }, 100);
  setTimeout(()=>clearInterval(interval), 10000);
}

// GET BUTTONS
const retryBtn = document.getElementById("retryBtn");
const nextBtn  = document.getElementById("nextBtn");

// SAVE TO LEADERBOARD FUNCTION
function saveScoreToLeaderboard(){
  let leaderboard = JSON.parse(localStorage.getItem("leaderboard")) || [];
  const existing = leaderboard.find(p => p.name === playerName);
  if(existing){
      if(score > existing.score) existing.score = score; // update if higher
  } else {
      leaderboard.push({ name: playerName, score: score });
  }
  leaderboard.sort((a,b)=>b.score - a.score);
  localStorage.setItem("leaderboard", JSON.stringify(leaderboard));
}

// --- BUTTONS & STATUS ---
if(passed){
  statusText.textContent = "LEVEL COMPLETE!";
  startRainingStars();
  playSound(1500,0.8);

  nextBtn.style.display = "block";
  retryBtn.style.display = "none";

  // Show next level button functionality
  nextBtn.onclick = () => {
    const levels = ['easy','medium','hard','master','legend'];
    let nextIndex = levels.indexOf(level) + 1;
    if(nextIndex >= levels.length) nextIndex = levels.length - 1;
    const nextLevel = levels[nextIndex];
    window.location.href = `game.html?mode=${mode}&level=${nextLevel}&theme=${theme}`;
  };

  // Auto-save score and redirect to leaderboard after 3s
  setTimeout(()=>{
    saveScoreToLeaderboard();
    window.location.href = "leaderboard.html?name=" + encodeURIComponent(playerName) + "&score=" + score;
  }, 3000);

}else{
  statusText.textContent = "LEVEL FAILED!";
  statusText.classList.add("failed");
  playSound(200,0.8);

  retryBtn.style.display = "block";
  nextBtn.style.display = "none";

  // Retry button
  retryBtn.onclick = () => {
    window.location.href = `game.html?mode=${mode}&level=${level}&theme=${theme}`;
  };

  // NO leaderboard redirect if failed
}
</script>



</body>
</html>


